<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Evaluation - FedImpute</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../mkapi-common.css" rel="stylesheet" />
        <link href="../../css/mkdocstrings.css" rel="stylesheet" />
        <link href="../../css/custom.css" rel="stylesheet" />
        <link href="../../css/mkapi.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Evaluation";
        var mkdocs_page_input_path = "user-guide\\evaluation.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> FedImpute
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Quick Start</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../overview/">Overview of FedImpute</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../get_started/">Install & Basic Usage</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../data_prep/">Data Preparation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenario_simulation/">Distributed Missing Data Scenario Builder</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../fed_imp/">Distributed Imputation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Evaluation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#basic-usage">Basic Usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#supported-evaluation">Supported Evaluation</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#imputation-quality">Imputation Quality</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#imputation-quality-via-tsne-visualization">Imputation Quality via tSNE visualization</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#local-regression-analysis">Local Regression Analysis</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#local-prediction">Local Prediction</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#federated-regression-analysis">Federated Regression Analysis</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#federated-prediction">Federated Prediction</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#save-evaluation-results">Save Evaluation Results</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../pipeline/">Pipeline API</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorial</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/basic_usage/">Basic Usage</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/benchmark/">Benchmarking Pipeline Demo</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/real_scenario/">Real World Distributed Imputation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/develop_new_method/">Developing Customized Methods</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/simulation/">Scenario Builder</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/fed_impute/">Imputation Execution Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/imputation_models/">Imputation Models</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">FedImpute</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Guide</li>
      <li class="breadcrumb-item active">Evaluation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="evaluation-of-imputation-outcomes">Evaluation of Imputation Outcomes</h1>
<p>Fedimpute provides a comprehensive evaluation module to assess the effectiveness of federated imputation algorithms across various missing data scenarios. 
The evaluation can be categorized into the following aspects:</p>
<ul>
<li><strong>Imputation Quality</strong>: Evaluate the quality of imputed data.</li>
<li><strong>Local Prediction</strong>: Evaluate the performance based on downstream local prediction tasks using imputed data.</li>
<li><strong>Federated Prediction</strong>: Evaluate the performance based on downstream federated prediction task using imputed data.</li>
</ul>
<h2 id="basic-usage">Basic Usage</h2>
<p>The <code>Evaluator</code> class is the <code>evaluation</code> module's main class, use its <code>evaluation()</code> function to perform evaluation.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">fedimpute.evaluation</span> <span class="kn">import</span> <span class="n">Evaluator</span>

<span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">()</span>
<span class="n">ret</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate_all</span><span class="p">(</span>
    <span class="n">env</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;imp_quality&#39;</span><span class="p">,</span> <span class="s1">&#39;pred_downstream_local&#39;</span><span class="p">,</span> <span class="s1">&#39;pred_downstream_fed&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">evaluator</span><span class="o">.</span><span class="n">show_results_all</span><span class="p">()</span>
</code></pre></div>
<p>The <code>Evaluator.evaluate_all()</code> method is used to evaluate the imputation outcomes. It takes the <code>FedImpEnv</code> object (see <a href="../fed_imp/">Federated Imputaton</a> and a list of evaluation aspects as input.
The evaluation aspects can be one or more of the following:</p>
<ul>
<li><code>imp_quality</code>: Evaluate the quality of imputed data.</li>
<li><code>pred_downstream_local</code>: Evaluate the performance of downstream prediction tasks using imputed data in a local setting.</li>
<li><code>pred_downstream_fed</code>: Evaluate the performance of downstream prediction tasks using imputed data in a federated setting.</li>
</ul>
<p>The <code>Evaluator.show_results_all()</code> method is used to display the evaluation results. It prints the evaluation results for each evaluation aspect.</p>
<h2 id="supported-evaluation">Supported Evaluation</h2>
<p>The following evaluation metrics are supported for each evaluation aspect:</p>
<h3 id="imputation-quality">Imputation Quality</h3>
<p>User can use the specific <code>evaluate_imputation_quality()</code> method in <code>evaluation.Evaluator</code> class provides functionalities to evaluate the quality of imputed data across clients comprehensively. It has several parameters: </p>
<ul>
<li><code>X_train_imps</code>: lists of client-specific imputed datasets</li>
<li><code>X_train_origins</code>: list of client-specific original complete datasets</li>
<li><code>X_train_masks</code>: list of client-specific missing value masks</li>
<li><code>metrics</code>: to denote the list of metrics for evaluation.</li>
</ul>
<p><strong>Metrics:</strong></p>
<ul>
<li><strong>Root Mean Squared Error (RMSE) <code>rmse</code></strong>: RMSE is calculated by taking the square root of the mean of </li>
<li>
<p>the squared differences between the imputed and original values. A lower RMSE indicates better imputation accuracy.</p>
</li>
<li>
<p><strong>Normalized RMSE <code>nrmse</code></strong>: Normalized RMSE is an extension of the standard RMSE that 
allows for a more intuitive interpretation and comparison of imputation qualities. It is 
calculated by dividing the RMSE by the range (i.e., standard deviation) of the original data. 
This normalization process scales the RMSE to a value between 0 and 1 to provide a standardized metric independent of the data scale.</p>
</li>
<li>
<p><strong>Sliced Wasserstein Distance <code>sliced-ws</code></strong>: Sliced Wasserstein distance is a metric 
that measures the dissimilarity between two high-dimensional probability distributions. 
We use sliced Wasserstein distance to assess the discrepancy between the probability distributions
of the imputed data and the original data for each client.
A smaller Wasserstein distance indicates a higher similarity between the imputed and original data distributions. </p>
</li>
</ul>
<p>User can use <code>show_imp_results()</code> to get the formatted results of evaluation.</p>
<div class="highlight"><pre><span></span><code>from fedimpute.evaluation import Evaluator

X_trains = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train&#39;)
X_train_imps = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train_imp&#39;)
X_train_masks = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train_mask&#39;)

evaluator = Evaluator()
ret = evaluator.evaluate_imp_quality(
    X_train_imps = X_train_imps,
    X_train_origins = X_trains,
    X_train_masks = X_train_masks,
    metrics = [&#39;rmse&#39;, &#39;nrmse&#39;, &#39;sliced-ws&#39;]
)
evaluator.show_imp_results()
</code></pre></div>
<h3 id="imputation-quality-via-tsne-visualization">Imputation Quality via tSNE visualization</h3>
<p><code>Evaluator</code> class also provides a method called <code>tsne_visualization()</code> to give the visualized comparison of similarity between the imputed data and the original data (ground-truth data). It visualizes the t-Distributed Stochastic Neighbor Embedding (t-SNE) of imputed data and original data so that the user can visually assess the effectiveness of the imputation outcome. tsne_visualization() takes parameters including clientâ€™s imputation data (<code>X_imp</code>) and original data (ground-truth data) (<code>X_origin</code>) and a random seed (<code>seed</code>) used for calculating t-SNE embedding.</p>
<div class="highlight"><pre><span></span><code>X_trains = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train&#39;)
X_train_imps = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train_imp&#39;)

evaluator.tsne_visualization(
    X_imps = X_train_imps,
    X_origins = X_trains,
    seed = 0
)
</code></pre></div>
<h3 id="local-regression-analysis">Local Regression Analysis</h3>
<p>The <code>run_local_regression_analysis()</code> method in the evaluation.Evaluator class provides functionality for evaluation via local regression analysis tasks. It accepts several parameters: </p>
<ul>
<li><code>X_train_imps, y_trains</code>: lists of client-specific imputed training datasets and targets</li>
<li><code>data_config</code>: the data configuration dictionary.</li>
<li><code>client_ids</code>: the list of clients ids to used for analysis, default to use all clients</li>
</ul>
<p>The method returns a Dict containing evaluation results. Users can utilize the <code>show_local_regression_results(client_idx)</code> method
in the evaluation.Evaluator class to print a formatted output of the evaluation results.</p>
<div class="highlight"><pre><span></span><code>X_trains, y_trains = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train&#39;, include_y=True)
X_train_imps = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train_imp&#39;)
data_config = env.get_data(data_type = &#39;config&#39;)

ret = evaluator.run_local_regression_analysis(
    X_train_imps = X_train_imps,
    y_trains = y_trains,
    data_config = data_config
)
evaluator.show_local_regression_results()
</code></pre></div>
<h3 id="local-prediction">Local Prediction</h3>
<p>After missing data are imputed,  the downstream task prediction can be performed on imputed data.  During the data partition stage, we retain a local test dataset for each client and a global test dataset for global data.  These test datasets can be used to evaluate downstream prediction models trained on clients' local imputed datasets to measure  the goodness of imputation and how it influences the prediction.  </p>
<p>The <code>run_local_prediction()</code> method in the evaluation.Evaluator class provides functionality for evaluation via local prediction tasks. It accepts several parameters: </p>
<ul>
<li><code>X_train_imps, y_train</code>: lists of client-specific imputed training datasets and targets</li>
<li><code>X_tests, y_tests</code>: lists of client-specific local test datasets and targets</li>
<li><code>model</code>: a model specification parameter. The method currently implements three built-in downstream prediction models: linear models ('lr'), random forests ('rf'), and two-layer neural networks ('nn'). </li>
<li><code>client_ids</code>: the list of clients ids to used for analysis, default to use all clients</li>
</ul>
<p>The method trains prediction models for each client using the imputed training data and evaluates performance on the corresponding test data. For classification tasks, the evaluation metrics include accuracy, F1-score, Area Under the Receiver Operating Characteristic Curve (AUROC), and Area Under
the Precision-Recall Curve (AUPRC). Mean squared error and R2 score are computed for regression tasks.</p>
<p><code>show_local_prediction_results()</code> will give a formatted result summary for the evaluation.</p>
<div class="highlight"><pre><span></span><code>X_trains, y_trains = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train&#39;, include_y=True)
X_tests, y_tests = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;test&#39;, include_y=True)
X_train_imps = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train_imp&#39;)
data_config = env.get_data(data_type = &#39;config&#39;)

ret = evaluator.evaluate_local_pred(
    X_train_imps = X_train_imps,
    X_train_origins = X_trains,
    y_trains = y_trains,
    X_tests = X_tests,
    y_tests = y_tests,
    data_config = data_config,
    model = &#39;nn&#39;,
    seed= 0
)
evaluator.show_local_prediction_results()
</code></pre></div>
<h3 id="federated-regression-analysis">Federated Regression Analysis</h3>
<p>The <code>run_fed_regression_analysis()</code> method in the evaluation.Evaluator class provides functionality for evaluation via federated regression analysis tasks. It accepts several parameters: </p>
<ul>
<li><code>X_train_imps, y_trains</code>: lists of client-specific imputed training data and targets</li>
<li><code>data_config</code>: the data configuration dictionary.</li>
</ul>
<p>The method returns a Dict containing evaluation results. Users can utilize the <code>show_fed_regression_results()</code> method
in the evaluation.Evaluator class to print a formatted output of the evaluation results.</p>
<div class="highlight"><pre><span></span><code>X_train_imps = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train_imp&#39;)
X_trains, y_trains = env.get_data(
    client_ids=&#39;all&#39;, data_type = &#39;train&#39;, include_y=True
)
data_config = env.get_data(data_type = &#39;config&#39;)

ret = evaluator.run_fed_regression_analysis(
    X_train_imps = X_train_imps,
    y_trains = y_trains,
    data_config = data_config
)
evaluator.show_fed_regression_results()
</code></pre></div>
<h3 id="federated-prediction">Federated Prediction</h3>
<p>We implement federated prediction functionality by <code>run_fed_prediction()</code> method. The current implementation supports federated prediction using a two-layer neural network with Federated Averaging (FedAvg) as the federated learning strategy. We will include more federated models in the future. Similarly, it uses accuracy, F1-Score, AUROC, AUPRC for classification tasks, and mean square error, R2 score for regression tasks. </p>
<p>It accepts multiple parameters: </p>
<ul>
<li><code>X_train_imps, y_trains</code>: lists of client-specific imputed training data and targets</li>
<li><code>X_tests, y_tests</code>: lists of client-specific local test data and targets</li>
<li><code>X_test_global, y_test_global</code>: global test data </li>
<li><code>model_name</code>: the name of the model to be used for federated prediction. Currently, federated models including<code>lr</code>, <code>svm</code>, <code>rf</code>, <code>xgboost</code>, <code>nn</code> are supported.</li>
<li><code>train_params</code>: the parameters for the federated learning training.</li>
<li><code>model_params</code>: the parameters for the model.</li>
<li><code>seed</code>: the random seed for the evaluation.</li>
</ul>
<p>The method returns a Dict containing evaluation results. Users can utilize the <code>show_fed_pred_result()</code> method
in the evaluation.Evaluator class to print a formatted output of the evaluation results.</p>
<div class="highlight"><pre><span></span><code>X_train_imps = env.get_data(client_ids=&#39;all&#39;, data_type = &#39;train_imp&#39;)
X_trains, y_trains = env.get_data(
    client_ids=&#39;all&#39;, data_type = &#39;train&#39;, include_y=True
)
X_tests, y_tests = env.get_data(
    client_ids=&#39;all&#39;, data_type = &#39;test&#39;, include_y=True
)
X_global_test, y_global_test = env.get_data(
    data_type = &#39;global_test&#39;, include_y = True
)
data_config = env.get_data(data_type = &#39;config&#39;)

ret = evaluator.run_fed_prediction(
    X_train_imps = X_train_imps,
    X_train_origins = X_trains,
    y_trains = y_trains,
    X_tests = X_tests,
    y_tests = y_tests,
    X_test_global = X_global_test,
    y_test_global = y_global_test,
    data_config = data_config,
    train_params = {
        &#39;global_epoch&#39;: 100,
        &#39;local_epoch&#39;: 10,
        &#39;fine_tune_epoch&#39;: 200,
    },
    seed= 0
)

evaluator.show_fed_prediction_results()
</code></pre></div>
<h2 id="save-evaluation-results">Save Evaluation Results</h2>
<p>The evaluation module provides convenient interfaces for presenting and exporting the results. All evaluation functions return results in a dictionary format, which can be formatted into readable tables through dedicated display functions, including <code>show_imp_results()</code>,
<code>show_local_prediction_results()</code>, <code>show_fed_prediction_results()</code> for each evaluation aspects. For further analysis and reporting, the <code>export_results()</code> method supports exporting results to different formats, including <code>pandas.DataFrame</code> and structured dictionaries.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../fed_imp/" class="btn btn-neutral float-left" title="Distributed Imputation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../pipeline/" class="btn btn-neutral float-right" title="Pipeline API">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../fed_imp/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../pipeline/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
