<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Federated Imputation - FedImpute</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../mkapi-common.css" rel="stylesheet" />
        <link href="../../css/mkdocstrings.css" rel="stylesheet" />
        <link href="../../css/custom.css" rel="stylesheet" />
        <link href="../../css/mkapi.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Federated Imputation";
        var mkdocs_page_input_path = "user-guide\\fed_imp.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> FedImpute
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Quick Start</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../overview/">Overview of FedImpute</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../get_started/">Install & Basic Usage</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../data_prep/">Data Preparation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../scenario_simulation/">Federated Missing Data Scenario Simulation</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Federated Imputation</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview-and-basic-usage">Overview and Basic Usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#environment-configuration">Environment Configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#supported-federated-imputation-algorithms">Supported Federated Imputation Algorithms</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#environment-setup">Environment Setup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#execute-federated-imputation">Execute Federated Imputation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#miscellaneous">Miscellaneous</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../evaluation/">Evaluation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/simulation/">Scenario simulation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/fed_impute/">FedImpute Execution Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/imputation_models/">Imputation Models</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">FedImpute</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">User Guide</li>
      <li class="breadcrumb-item active">Federated Imputation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="executing-federated-imputation-algorithms">Executing Federated Imputation Algorithms</h1>
<p>The <code>FedImputeEnv</code> class is the <code>execution_environment</code> module's main class. 
It is used to configure the federated imputation environment and execute federated imputation algorithms.</p>
<h2 id="overview-and-basic-usage">Overview and Basic Usage</h2>
<p>Use needs to initialize the <code>FedImputeEnv</code> class and configure the environment using the <code>configuration</code> 
method - what imputer to use, what federated strategy to use, and what fitting mode to use. 
Then, use the <code>setup_from_simulator</code> method to set up the environment using the simulated data from <code>simulator</code> class, 
see <a href="../scenario_simulation/">Scenario Simulation Section</a>. 
Finally, use the <code>run_fed_imputation</code> method to execute the federated imputation algorithms.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">fedimpute.execution_environment</span> <span class="kn">import</span> <span class="n">FedImputeEnv</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">FedImputeEnv</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">configuration</span><span class="p">(</span><span class="n">imputer</span> <span class="o">=</span> <span class="s1">&#39;gain&#39;</span><span class="p">,</span> <span class="n">fed_strategy</span><span class="o">=</span><span class="s1">&#39;fedavg&#39;</span><span class="p">,</span> <span class="n">fit_mode</span> <span class="o">=</span> <span class="s1">&#39;fed&#39;</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">setup_from_simulator</span><span class="p">(</span><span class="n">simulator</span> <span class="o">=</span> <span class="n">simulator</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">run_fed_imputation</span><span class="p">(</span><span class="n">run_type</span><span class="o">=</span><span class="s1">&#39;sequential&#39;</span><span class="p">)</span>
</code></pre></div>
<p>Note that if you use cuda version of torch, remember to set environment variable for cuda deterministic behavior first
<div class="highlight"><pre><span></span><code><span class="c1"># bash (linux)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CUBLAS_WORKSPACE_CONFIG</span><span class="o">=</span>:4096:8
<span class="c1"># powershell (windows)</span>
<span class="nv">$Env</span>:CUBLAS_WORKSPACE_CONFIG<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;:4096:8&quot;</span>
</code></pre></div></p>
<h2 id="environment-configuration">Environment Configuration</h2>
<p>The <code>env.configuration()</code> method is used to configure the environment. It takes the following arguments:</p>
<p><strong>Options</strong>:</p>
<ul>
<li><strong>imputer</strong> (str) - name of imputation algorithm to use. Options: <code>fed_mean</code>, <code>fed_em</code>, <code>fed_ice</code>, <code>fed_missforest</code>, <code>gain</code>, <code>miwae</code></li>
<li><strong>fed_strategy</strong> (str) - name of federated strategy to use. Options: <code>fedavg</code>, <code>fedprox</code>, <code>scaffold</code>, <code>fedavg_ft</code></li>
<li><strong>fit_mode</strong> (str) - name of fitting mode to use - federated imputation, local-only imputation or centralized imputation. Options: <code>fed</code>, <code>local</code>, <code>central</code></li>
<li><strong>save_dir_path</strong> (str) - path to persist clients and server training process information (imputation models, imputed data etc.) for future use.</li>
</ul>
<p><strong>Other Params</strong>:</p>
<ul>
<li><strong>imputer_params</strong> (Union[None, dict]) = None - parameters for imputer </li>
<li><strong>fed_strategy_params</strong> (Union[None, dict]) = None - parameters for federated strategy</li>
<li><strong>workflow_params</strong> (Union[None, dict]) = None - parameters for workflow - 
<code>Workflow</code> class contains the logic for federated imputation workflow. It is associated with each <code>Imputer</code> class. </li>
<li>The built-in workflows are: <code>ice</code> - for ICE based imputation, <code>em</code> - for EM imputation, <code>jm</code> - for joint modeling based imputation such as VAE or GAN based imputation.</li>
</ul>
<h2 id="supported-federated-imputation-algorithms">Supported Federated Imputation Algorithms</h2>
<p>Federated Imputation Algorithms:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Method</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Fed Strategy</th>
<th style="text-align: center;">Imputer (code)</th>
<th style="text-align: left;">Workflow</th>
<th style="text-align: left;">Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">Fed-Mean</td>
<td style="text-align: center;">Non-NN</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;"><code>fed_mean</code></td>
<td style="text-align: left;"><code>simple</code></td>
<td style="text-align: left;">-</td>
</tr>
<tr>
<td style="text-align: center;">Fed-EM</td>
<td style="text-align: center;">Non-NN</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;"><code>fed_em</code></td>
<td style="text-align: left;"><code>em</code></td>
<td style="text-align: left;"><a href="https://github.com/vanderschaarlab/hyperimpute/blob/main/src/hyperimpute/plugins/imputers/plugin_EM.py">EM</a>, <a href="https://arxiv.org/abs/2108.10252">FedEM</a></td>
</tr>
<tr>
<td style="text-align: center;">Fed-ICE</td>
<td style="text-align: center;">Non-NN</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;"><code>fed_ice</code></td>
<td style="text-align: left;"><code>ice</code></td>
<td style="text-align: left;"><a href="https://pubmed.ncbi.nlm.nih.gov/33122624/">FedICE</a></td>
</tr>
<tr>
<td style="text-align: center;">Fed-MissForest</td>
<td style="text-align: center;">Non-NN</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;"><code>fed_missforest</code></td>
<td style="text-align: left;"><code>ice</code></td>
<td style="text-align: left;"><a href="https://github.com/vanderschaarlab/hyperimpute/blob/main/src/hyperimpute/plugins/imputers/plugin_missforest.py">MissForest</a>, <a href="https://pubmed.ncbi.nlm.nih.gov/35139148/">Fed Randomforest</a></td>
</tr>
<tr>
<td style="text-align: center;">MIWAE</td>
<td style="text-align: center;">NN</td>
<td style="text-align: center;"><code>fedavg</code>, <code>fedprox</code>,...</td>
<td style="text-align: center;"><code>miwae</code></td>
<td style="text-align: left;"><code>jm</code></td>
<td style="text-align: left;"><a href="https://github.com/vanderschaarlab/hyperimpute/blob/main/src/hyperimpute/plugins/imputers/plugin_miwae.py">MIWAE</a></td>
</tr>
<tr>
<td style="text-align: center;">GAIN</td>
<td style="text-align: center;">NN</td>
<td style="text-align: center;"><code>fedavg</code>, <code>fedprox</code>, ...</td>
<td style="text-align: center;"><code>gain</code></td>
<td style="text-align: left;"><code>jm</code></td>
<td style="text-align: left;"><a href="https://github.com/vanderschaarlab/hyperimpute/blob/main/src/hyperimpute/plugins/imputers/plugin_gain.py">GAIN</a></td>
</tr>
<tr>
<td style="text-align: center;">Not-MIWAE</td>
<td style="text-align: center;">NN</td>
<td style="text-align: center;"><code>fedavg</code>, <code>fedprox</code>, <code>fedavg_ft</code>, ...</td>
<td style="text-align: center;"><code>notmiwae</code></td>
<td style="text-align: left;"><code>jm</code></td>
<td style="text-align: left;"><a href="https://arxiv.org/abs/2006.12871">Not-MIWAE</a></td>
</tr>
<tr>
<td style="text-align: center;">GNR</td>
<td style="text-align: center;">NN</td>
<td style="text-align: center;"><code>fedavg</code>, <code>fedprox</code>, <code>fedavg_ft</code>, ...</td>
<td style="text-align: center;"><code>gnr</code></td>
<td style="text-align: left;"><code>jm</code></td>
<td style="text-align: left;"><a href="https://dl.acm.org/doi/abs/10.1145/3583780.3614835?casa_token=o8dv16sHJcMAAAAA:aAIvug_7cp9oUJSB7ZfTvzUksPyuP6Jbcl3TlHsvXXGEwIe4AbQuHCTlxXZtjDKlymfO30n2o-E9iw">GNR</a></td>
</tr>
</tbody>
</table>
<p>Federated Strategies:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Method</th>
<th style="text-align: center;">Type</th>
<th style="text-align: center;">Fed_strategy(code)</th>
<th style="text-align: left;">Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">FedAvg</td>
<td style="text-align: center;">global FL</td>
<td style="text-align: center;"><code>fedavg</code></td>
<td style="text-align: left;"><a href="https://arxiv.org/pdf/1602.05629">FedAvg</a></td>
</tr>
<tr>
<td style="text-align: center;">FedProx</td>
<td style="text-align: center;">global FL</td>
<td style="text-align: center;"><code>fedprox</code></td>
<td style="text-align: left;"><a href="https://arxiv.org/pdf/1812.06127">FedProx</a></td>
</tr>
<tr>
<td style="text-align: center;">Scaffold</td>
<td style="text-align: center;">global FL</td>
<td style="text-align: center;"><code>scaffold</code></td>
<td style="text-align: left;"><a href="https://arxiv.org/pdf/1910.06378">Scaffold</a></td>
</tr>
<tr>
<td style="text-align: center;">FedAdam</td>
<td style="text-align: center;">global FL</td>
<td style="text-align: center;"><code>fedadam</code></td>
<td style="text-align: left;"><a href="https://arxiv.org/pdf/2003.00295">FedAdam</a></td>
</tr>
<tr>
<td style="text-align: center;">FedAdagrad</td>
<td style="text-align: center;">global FL</td>
<td style="text-align: center;"><code>fedadagrad</code></td>
<td style="text-align: left;"><a href="https://arxiv.org/pdf/2003.00295">FedAdaGrad</a></td>
</tr>
<tr>
<td style="text-align: center;">FedYogi</td>
<td style="text-align: center;">global FL</td>
<td style="text-align: center;"><code>fedyogi</code></td>
<td style="text-align: left;"><a href="https://arxiv.org/pdf/2003.00295">FedYogi</a></td>
</tr>
<tr>
<td style="text-align: center;">FedAvg-FT</td>
<td style="text-align: center;">personalized FL</td>
<td style="text-align: center;"><code>fedavg_ft</code></td>
<td style="text-align: left;"><a href="">FedAvg-FT</a></td>
</tr>
</tbody>
</table>
<h2 id="environment-setup">Environment Setup</h2>
<p>After configuring environment, we need to initialize the environment -  initialize <code>Client</code>s, <code>Server</code> objects with simulated data from simulation module.
Currently, the <code>FedImputeEnv</code> class supports the two ways to set up the environment. First way is to directly setup the environment from <code>simulator</code> 
class by using <code>env.setup_from_simulator(simulator)</code> method. 
<div class="highlight"><pre><span></span><code><span class="n">env</span><span class="o">.</span><span class="n">setup_from_simulator</span><span class="p">(</span><span class="n">simulator</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></p>
<p>The second way is to setup the environment by using <code>env.setup_from_data()</code> method. It can be used
in the scenario where user have their own data that not simulated from simulator class. Example:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">clients_train_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">clients_train_data_ms</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">clients_test_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="n">global_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">data_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;target&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
    <span class="s1">&#39;task_type&#39;</span><span class="p">:</span> <span class="s1">&#39;regression&#39;</span><span class="p">,</span>
    <span class="s1">&#39;clf_type&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s1">&#39;num_cols&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">clients_seeds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

<span class="n">env</span><span class="o">.</span><span class="n">setup_from_data</span><span class="p">(</span>
    <span class="n">clients_train_data</span><span class="p">,</span> <span class="n">clients_test_data</span><span class="p">,</span> <span class="n">clients_train_data_ms</span><span class="p">,</span> <span class="n">clients_seeds</span><span class="p">,</span> <span class="n">global_test</span><span class="p">,</span> <span class="n">data_config</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="execute-federated-imputation">Execute Federated Imputation</h2>
<p>After setting up the environment, we can execute the federated imputation algorithms using <code>run_fed_imputation()</code> method. Currently, we support two types of simulation execution (1) Run FL in sequential mode (<code>run_type="sequential"</code>), in this model, there is no parallel, whole processes of imputation for clients  run sequantially by using for loop (2) Run federated imputation in parallel mode (<code>run_type="parallel"</code>), it will simulate different processes for clients and server and then using workflow to manage communication between clients and server to approach the real world FL environment.</p>
<div class="highlight"><pre><span></span><code><span class="n">env</span><span class="o">.</span><span class="n">run_fed_imputation</span><span class="p">(</span><span class="n">run_type</span><span class="o">=</span><span class="s1">&#39;squential&#39;</span><span class="p">)</span>
</code></pre></div>
<h2 id="miscellaneous">Miscellaneous</h2>
<ul>
<li><strong>verbose</strong> (int) - Verbosity level. 0: no output, 1: minimal output, 2: detailed output</li>
<li><strong>seed</strong> (int) - Seed for reproducibility</li>
<li><strong>logging</strong> (bool) - Whether to log the training process</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../scenario_simulation/" class="btn btn-neutral float-left" title="Federated Missing Data Scenario Simulation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../evaluation/" class="btn btn-neutral float-right" title="Evaluation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../scenario_simulation/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../evaluation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS_HTML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
